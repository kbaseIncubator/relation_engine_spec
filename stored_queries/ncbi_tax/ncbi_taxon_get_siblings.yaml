# Get the array of siblings for a taxon
# Results are limited to 10k
name: ncbi_taxon_get_siblings
params:
  type: object
  required: [key]
  properties:
    key:
      type: string
      title: Document key
      description: Key of the taxon vertex for which you want to find siblings
    limit:
      type: integer
      default: 20
      description: Maximum result limit
      maximum: 1000
    offset:
      type: integer
      default: 0
      description: Result offset for pagination
      maximum: 100000
query: |
  // First find the taxon in the tree
  for t in ncbi_taxon
    filter t._key == @key
    // Now traverse to the parent
    for parent in 1..1 OUTBOUND t ncbi_child_of_taxon
      // Then traverse back down to the siblings
      for c in 1..1 INBOUND parent ncbi_child_of_taxon
        filter c != t
        sort c.scientific_name asc
        limit @offset, @limit
        return c
